# Домашнее задание к занятию «Резервное копирование баз данных» - Козырев Роман

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

### Решение 1.

1.1. 

Необходимо восстанавливать данные в полном объёме за предыдущий день. Вначале недели, допустим, это будет технологическое окно в 03:00 утра понедельника, когда нагрузки на БД не будет, мы будем делать Полное резервное копирование. Далее, мы будем делать Дифференциальный бэкап каждый день - такой бэкап позволит нам в случае, когда всё-таки нам понадобится бэкап БД, восстановить данные за предыдущий день в полном объёме. Сначала восстанавливаем Полный бэкап и к Полному бэкапу восстанавливаем Дифференциальный бэкап за нужный нам день недели, например за четверг. Можно конечно делать бэкап БД с помощью Инкрементного бэкапа каждый день, но в таком случае для восстановления данных за четверг нам нужно будет сначала восстановить Полный бэкап, а потом восстанавливать Инкрементный бэкап за понедельник, Инкрементный бэкап за вторник, Инкрементный бэкап за среду, а потом уже Инкрементный бэкап за четверг. В таком случае есть вероятность того, что если наш Инкрементый бэкап, например за вторник, отработал неккорректно, то данные за четверг уже не восстановить.

1.2. 

Необходимо восстанавливать данные за час до предполагаемой поломки. В случае, если наша "Финансовая компания" мелкая компания: вначале недели, допустим, это будет технологическое окно в 03:00 утра понедельника, когда нагрузки на БД не будет, мы будем делать Полное резервное копирование. Далее, мы будем делать Дифференциальный бэкап каждый день. Далее будем делать Инкрементный бэкап каждый час.

В случае, если наша "Финансовая компания" крупная компания: допустим, это будет технологическое окно в 03:00 утра, когда нагрузки на БД не будет, мы будем делать Полное резервное копирование каждый день. Далее, мы будем делать Дифференциальный бэкап каждые три часа. Далее будем делать Инкрементный бэкап каждый час.

В случае, если наша "Финансовая компания" очень крупная компания: допустим, это будет технологическое окно в 03:00 утра, когда нагрузки на БД не будет, мы будем делать Полное резервное копирование каждый день. Далее, мы будем делать Дифференциальный бэкап каждый час. Далее будем делать Инкрементный бэкап каждые 15 минут.

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

### Решение 2

2.1

Например, БД Zabbix.

Резервирование: pg_dump zabbix > /tmp/zabbix.dump

Восстановление БД: pg_restore -d zabbix /tmp/zabbix.dump
---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

### Решение 3

3.1

Например, сделать бекап всех баз данных, хранящихся в MySQL: 
mysqldump --flush-logs --delete-master-logs --single-transaction --all-databases > /tmp/mysqlbackup/
